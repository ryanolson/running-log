{% set page_title = 'Miles' %}
{% extends 'layouts/base.html' %}

{% macro miles_panel(header, miles, footer, id=None, day=None, category=None, editable=True) %}
<div class="miles-panel col-xs-3 col-sm-1">
    <div class="panel {% if category %}panel-{{category}}{% else %}panel-default{% endif %}">
  <div class="panel-heading">
    <h3 class="panel-title text-center">{{ header }}</h3>
  </div>
  <div class="panel-body text-center distance" {% if id and day %}id="{{ id }}" day="{{ day }}"{% endif %} {% if editable %}editable{% endif %}>
    {{ miles }}
  </div>
  <div class="panel-footer text-center">
    {{ footer }}
  </div>
</div>
</div>
{% endmacro %}

{% macro miles_day_panel(day, miles, category=None, editable=True) %}
{{ miles_panel(day.format('ddd'), miles, day.format('M/D'), id=day.format('YYYY-MM-DD'), day=day.format('dddd MMMM D, YYYY'), category=category, editable=editable) }}
{% endmacro %}

{% block css %}
{{ super() }}
<style>
.miles-panel {
    padding-left: 2px;
    padding-right: 2px;
}
.distance {
    font-size: xx-large;
}
.panel-footer {
    padding-left: 2px;
    padding-right: 2px;
}
.panel-body {
    padding-left: 2px;
    padding-right: 2px;
    padding-top: 5px;
    padding-bottom: 5px;
}
.panel-heading {
    padding-left: 2px;
    padding-right: 2px;
}
.form-inline {
    display: inline-block;
}
input#submit {
    padding-left: 2px;
    padding-right: 2px;
}
</style>
{% endblock %}

{% block body %}
<div class="row">
    <div class="hidden-xs col-sm-2 col-md-2"></div>
    {% for day in this_week %}
        {% if day == now %}
            {{ miles_day_panel(day, runs.miles_for_date(day), category='primary') }}
        {% elif day < now %}
            {{ miles_day_panel(day, runs.miles_for_date(day), category='info') }}
        {% else %}
            {{ miles_day_panel(day, '--', editable=False) }}
        {% endif %}
    {% endfor %}
    {{ miles_panel('Total', runs.total_miles, 'Week', editable=False) }}
</div>

<!-- Modal Dialog(s) -->
{{ run_entry_dialog|safe }}
{% endblock %}



{% from "macros/js.html" import form_async_data %}

{% block js_btm %}
{{ super() }}
<script>
$('.panel-body').click(function() {
    $('.modal-title').text($(this).attr('day'));
    $('input#date').attr('value', $(this).attr('id'));
    $('input#miles').attr('value', parseInt($(this).text()));
    if($(this).is("[editable]")) {
        $('#run_entry_dialog').modal('show');
    }
});
$('#run_entry_dialog').on('hidden.bs.modal', function (e) {
    $('.alert').alert('close');
})
{% call form_async_data() %}
    var $next = $(data).find('#next').attr('value');
    if($next) {
        window.location.replace($next);
    }
    var $target_body = $($target.find('.modal-body'));                                                                                                                                                     
    var $data_body = $($(data).find('.modal-body'));
    $target_body.html($data_body.html());
{% endcall %}
</script>
{% endblock %}
